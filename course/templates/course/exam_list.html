<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GaME</title>
  {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'course/style.css' %}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
        function chkclk(exam_id){
            var chkbox_stat = document.getElementById('chkboxx' + exam_id).checked;
            console.log('chkbox_stat = ' + chkbox_stat);
            $.ajax({
                url: "{% url 'tog_ex_vis' %}",
                data: { csrfmiddlewaretoken: '{{ csrf_token }}', 
                    visible:chkbox_stat, 
                    ex_id: exam_id, 
                },
                type: 'post',
                dataType: 'json',
                async: true,
                success: function (data) {
                    console.log("ajax returned. data = " + data);
                }
            });
        }
  </script>
</head>
<body>
  <main>
    
    <p name = "username" >Welcome, <font class = "username">{{ user.username }}</font></p>
    {% if instructor %}
        <p name = "role" >Role: <font class = "role">Instructor</font></p>
        
    {% endif%}
    {% if assistant%}
        <p name = "role" >Role: <font class = "role">Teaching Assistant</font></p>
     
    {% endif %}
    {% if student%}
        <p name = "role" >Role: <font class = "role">Student</font></p>
    {% endif %}

    {% if course %}
        <p name = "course" >{{course.course_id}}
            <font class = "sem2">{{course.semester}} {{course.year}}</font>
        </p>
    {% endif %}

    {%if exams%}
        <center><table>
            <tr>
                <th name = "exam_list">
                    Exam_Name
                </th>
                <th name = "exam_list">
                    Weightage
                </th>
                {% if instructor %}
                    <th name = "exam_list">
                        Visible to students
                    </th>
                    <th name = "exam_list">
                    Delete Exam
                    </th>
                {%else%}
                    <th name = "exam_list">
                        Grading Status
                    </th>
                {% endif %}   
            </tr>
            {% for exam in exams %}
                <tr>
                    <td name = "exam_list">
                        <a name = "course_id" href="/game/qn/{{ exam.id }}/">{{exam.exam_name}}</a>
                    </td>
                    <td name = "exam_list">
                        {{exam.weightage}}
                    </td>
                    
                    {% if instructor %}
                        <td name = "exam_list">
                            <form id="chkbox{{ exam.id }}">
                                {% csrf_token %}
                                {% if exam.exam_graded is True %}
                                <input type="checkbox" id="chkboxx{{ exam.id }}" onclick="chkclk({{ exam.id }})" checked>
                                {% else %}
                                <input type="checkbox" id="chkboxx{{ exam.id }}" onclick="chkclk({{ exam.id }})">
                                {% endif %}
                            </form>
                        </td>
                        <td name = "exam_list">
                            <form method="POST" action="{% url 'del_exam' exam.id %}">
                                {% csrf_token %}
                                <button name = "del_button" type="submit" align= "right">Delete</button>
                            </form>
                        </td>
                    {%else%}
                        <td name = "exam_list">
                            {%if exam.exam_graded%}
                                Graded
                            {%else%}
                                Not Graded
                            {%endif%}
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
        </center> 

    {%else%}
            <p name="noexam">No exams to display!!</p>
    {%endif%}
    {% if instructor %}
    <!-- <p>You can add a new exam here:</p> -->
    <center>
        <form method="POST" action="{% url 'add_exam_view' ciid %}">
            {% csrf_token %}
            <input type="text" class = "exam" name="ex_name" id="ex_nameid" placeholder="Exam name" required>
            <input type="text" class = "exam" name="ex_wt" id="ex_wtid" placeholder="Weightage" required>
            <button name = "gen_button" type="submit">Create Exam</button>
        </form>
    </center>
    {% endif%}
	<div class = "logout">
        <a name = "logout" href="{% url 'logout' %}"> logout! </a>
    </div>
  </main>
</body>
</html>
